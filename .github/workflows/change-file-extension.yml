name: Replace .md with .qmd and Add Header

on:
    workflow_dispatch:
    push:
        branches:
            - main # Trigger on push to the main branch

jobs:
    replace_and_add_header:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                  ref: main # Main branch

            - name: Set up Git user
              run: |
                  git config --global user.name "github-actions[bot]"
                  git config --global user.email "github-actions[bot]@users.noreply.github.com"

            - name: Create a new branch
              run: |
                  git checkout -b update-md-to-qmd
                  git fetch origin target-branch
                  git checkout target-branch

            - name: Replace .md files with .qmd files and add headers
              run: |
                  # Loop through all .md files
                  for file in $(find . -type f -name "*.md"); do
                    # Extract the filename without the extension
                    filename=$(basename "$file" .md)
                    # Prepend the header with the title
                    echo -e "---\ntitle: $filename\n---\n$(cat "$file")" > "$file"
                    # Rename the .md file to .qmd
                    mv "$file" "${file%.md}.qmd"
                  done

            - name: Commit and push changes
              run: |
                  git add .
                  git commit -m "Replace .md with .qmd and add headers"
                  git push origin target-branch
